import{_ as s,v as a,b as n,R as o}from"./chunks/framework.caa0fbaf.js";const C=JSON.parse('{"title":"问题追踪","description":"","frontmatter":{},"headers":[],"relativePath":"guide/course/trace.md","filePath":"guide/course/trace.md","lastUpdated":1690970407000}'),l={name:"guide/course/trace.md"},p=o(`<h1 id="问题追踪" tabindex="-1">问题追踪 <a class="header-anchor" href="#问题追踪" aria-label="Permalink to &quot;问题追踪&quot;">​</a></h1><p>在<code>YinTao: version-1.1.5</code>版本开始，引擎内提供了执行问题追踪功能。使用追踪功能可以大幅提高远程执行问题调试的时间，可帮助您在脚本运行后探索执行的记录。 并提供本地或在线预览的能力。</p><h2 id="使用跟踪" tabindex="-1">使用跟踪 <a class="header-anchor" href="#使用跟踪" aria-label="Permalink to &quot;使用跟踪&quot;">​</a></h2><p>使用跟踪的方法为，在调用执行接口时，向执行参数<code>remoteReport</code>中追加 <code>trace</code> 地址 <code>trace</code>可以传递 <code>url</code>，或本地路径(非本地执行只能传递<code>http</code>地址)</p><h2 id="本地追踪" tabindex="-1">本地追踪 <a class="header-anchor" href="#本地追踪" aria-label="Permalink to &quot;本地追踪&quot;">​</a></h2><p>例:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">remoteReport</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">trace</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/Users/zhouyuan11/work/test/trace.zip</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">  </span><span style="color:#676E95;font-style:italic;">// 本地路径需要以zip结尾</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">script</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">await page.to(&#39;https://www.baidu.com/&#39;);await sleep(1000);//点击我的权益;</span><span style="color:#A6ACCD;">\\n</span><span style="color:#C3E88D;">await dom.click(&#39;text=2002元&#39;);await sleep(2000);</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>当执行完成后, 会在对应的位置生成追踪信息<code>zip</code>文件。</p><h2 id="远程追踪" tabindex="-1">远程追踪 <a class="header-anchor" href="#远程追踪" aria-label="Permalink to &quot;远程追踪&quot;">​</a></h2><p>例:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">remoteReport</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">trace</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://127.0.0.1:8910/trace</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">  </span><span style="color:#676E95;font-style:italic;">// 本地路径需要以zip结尾</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">script</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">await page.to(&#39;https://www.baidu.com/&#39;);await sleep(1000);//点击我的权益;</span><span style="color:#A6ACCD;">\\n</span><span style="color:#C3E88D;">await dom.click(&#39;text=2002元&#39;);await sleep(2000);</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>当采用远程追踪时，在脚本执行结束后, <code>YinTao</code>会向目标地址传递追踪信息<code>zip</code>文件。</p><p>上传方式为:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">method</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#FFCB6B;font-style:italic;">上报运行跟踪内容</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">reportTrace</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">filePath</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">storage</span><span style="color:#89DDFF;">?:</span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">FormData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">require</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">form-data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">param</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">FormData</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">param</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">trace</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">   </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createReadStream</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filePath</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">param</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">storage</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">storage</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">param</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">headers</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">Content-Type</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">application/json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">axios</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">param</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> headers</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">param</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getHeaders</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> timeout</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">60</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">3</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// 追踪超时设置为3分钟</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>远程服务需要接收<code>zip</code>文件，以放置在<code>oss</code>资源路径中。</p><h2 id="查看追踪信息" tabindex="-1">查看追踪信息 <a class="header-anchor" href="#查看追踪信息" aria-label="Permalink to &quot;查看追踪信息&quot;">​</a></h2><p>预览追踪可以通过<a href="https://trace.playwright.dev/" target="_blank" rel="noreferrer">trace.dev</a>进行, 如果是本地文件，可以通过选择文件的信息打开对应<code>追踪.zip</code>文件进行浏览</p><p>远程文件也可通过传递给<code>trace</code> 进行预览</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//trace.playwright.dev/?trace=http_url // 的方式进行</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 例如:</span></span>
<span class="line"><span style="color:#FFCB6B;">https</span><span style="color:#89DDFF;">:</span><span style="color:#676E95;font-style:italic;">//trace.playwright.dev/?trace=https://storage.jd.com/assert/nihao2.zip</span></span></code></pre></div><p><a href="https://trace.playwright.dev/?trace=https://storage.jd.com/assert/nihao2.zip" target="_blank" rel="noreferrer">点击此处在线查看跟踪效果</a></p><h2 id="相关文档及资料参考" tabindex="-1">相关文档及资料参考 <a class="header-anchor" href="#相关文档及资料参考" aria-label="Permalink to &quot;相关文档及资料参考&quot;">​</a></h2><p><a href="https://playwright.dev/docs/trace-viewer" target="_blank" rel="noreferrer">playwright-trace</a>, <a href="https://www.chromium.org/developers/how-tos/trace-event-profiling-tool/recording-tracing-runs/" target="_blank" rel="noreferrer">chromium-trace</a></p>`,22),e=[p];function t(r,c,F,y,D,i){return a(),n("div",null,e)}const h=s(l,[["render",t]]);export{C as __pageData,h as default};
